### Prune.js

Prune.js is a JavaScript code optimizer, compressor, and concatenator, source map generator.

It auto-discovers and "compiles" your "source" JavaScript spread over multiple files and directorie into one minified "assembly" ready to be served with a matching source map file.

Prune.js is especially useful for turning a diverse tree of AMD modules (and CommonJS modules, and AMD plugin resources) into a single compressed file. (It turns various files, including those referred to through 'text!', 'js!', 'css!', 'cjs!' AMD plugins into in-line, named AMD modules.)

Prune.js is a bit like `r.js` but is not tied to and does not replace any particular AMD loader. (None of that require.js-specific fragile settings magic here and require.js is not forced upon you.) Prune.js is more general-purpose. It's like as if you had `automake` for JavaScript.

Oh, yes. Prune.js certainly works on Windows, as well, as on other Node.js-supporting operating systems.

### Roots

At the core of Prune.js there are:
* ESPrima - a JavaScript parser, AST tree generator
* ESMangle - an AST tree optimizer, mangler
* ESCodeGen - an AST-to-JavaScript and AST-to-SourceMap generator
* Robert Tarjan's algorythm for topological sorting of dependency trees containing circular dependencies
* A tiny bit of real magic

All of that is served as ONE javascript file ready to be ran against Node.js. (No need to pull modules. Everything is included.)

### Why

Building large JavaScript applications is a pain. There are all-inclusive and constricted-by-design kits like SproutCore where you get sane but inflexible build logic with the kit. There are free-form collections of kits where you need to hand-stitch the various JavaScript, template, css files into a build script. There is also r.js, which ties you to require.js and its evergrowing collection of obscure settings combinations and (as personally witnesed with 1.x versions) very fragile loading logic. 

Prune.js is an attempt to unchain an average web developer from a particular toolkit, yet still provide top-notch, elastic, autoforming, supporting application build infrastructure.

### Build walk-through

Prune.js is supposed to be pointed at the "root" JavaScript file for a particular cohesive set of "source" JavaScript files. The "root" JavaScript file does not have to be an AMD or CJS module. Prune.js automatically detects the type of references used inside and traverses the dependency chain declared within the files.

While support for CommonJS-style dependency tree is planned but not yet present, full support for AMD modules pattern is here.

Prune.js resolves *local* AMD references within `require` and `define` calls. Prune.js converts static references to non-module resources like text loading ('text!' plugin), CSS loading ('css!' plugin), plain JavaScript loading ('js!' plugin) (and soon CommonJS module loading ('cjs!' plugin)) into wrapped, automatically-named AMD modules and assembles and minifies all code into one "main" JavaScript file. 

Absolute AMD references and other AMD references not resolved to local files or in-lined named defines are left unchanged. This means your custom AMD plugins should continue to work.

Because all concatenation manipulations are done in AST tree form, all code preserves references to its original filename, line and column. Source Maps generated by Prune.js, thus, contain line, column references that match exactly to the original source JavaScript files.

### How

After downloading prune.js file, put it anywhere you desire. Run it against Node.js to see it complain about missing options:

	node ~/bin/prune.js

Prune.js needs to know the following:

1. What is the "root" of the future web page. That means if your future index.html is located in `~/projects/myapp/checkout` and that folder will behave as root node for resolution of all relative dependencies for AMD modules, that's the "root" folder.

2. What's "main" JavaScript file. If no file is specified, it defaults to `./main.js` where the relative reference is against the "root" of the page. Use `-s` option for specifying main JavaScript source file.

3. What's the "target" JavaScript file name. This is the file where concatenated, minified resources will be inserted. (Although writing this file to a folder other than the one where "main" file resides is supported, the untouched relative AMD references are not adjusted to change in accordance.) Use `-t` option for specifying target (output) file.

4. What Prune.js needs to do. Prune.js expects a collection of commands that it auto-sorts and runs in order. Use `-c` option for specifying one or more commands.

Here is how you communicate 1, 2, 3 and 4 to Prune.js:

	# Make the "root" folder your Current Working Dir
	cd ~/projects/myapp/checkout
	# run Prune.js, specifying the source, target
	node ~/bin/prune.js -s ./main.js -t ./main.min.js -c minify amd

Note that two commands are given: `minify` and `amd` each one refers to a separate hive of commands needed to accomplish parsing of the AMD require tree, code optimization, minification. 
